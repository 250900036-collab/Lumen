<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>LUMEN</title>

<style>
body{
  margin:0;
  height:100vh;
  font-family:Arial, sans-serif;
  background: radial-gradient(circle at center, #7b2cff, #1a0033);
  color:white;
  display:flex;
  justify-content:center;
  align-items:center;
  flex-direction:column;
  text-align:center;
}

#inicio{
  display:flex;
  flex-direction:column;
  align-items:center;
}

button{
  width:220px;
  height:220px;
  border-radius:50%;
  border:none;
  background:red;
  color:white;
  font-size:45px;
  font-weight:bold;
  cursor:pointer;
  box-shadow:0 0 60px red;
}

#cameraScreen{
  display:none;
  position:fixed;
  top:0;
  left:0;
  width:100%;
  height:100%;
  background:black;
}

video{
  width:100%;
  height:100%;
  object-fit:cover;
}
</style>
</head>
<body>

<div id="inicio">
  <h1>LUMEN</h1>
  <button onclick="activarSOS()">SOS</button>
  <p>Presiona si necesitas ayuda</p>
  <div id="estado"></div>
</div>

<div id="cameraScreen">
  <video id="video" autoplay playsinline></video>
</div>

<script>

function activarSOS(){

  //  Sirena m谩s fuerte tipo oscilador
  const ctx = new (window.AudioContext || window.webkitAudioContext)();
  const osc = ctx.createOscillator();
  const gain = ctx.createGain();

  osc.type = "square";
  osc.frequency.value = 1000;
  gain.gain.value = 1;

  osc.connect(gain);
  gain.connect(ctx.destination);
  osc.start();

  setTimeout(()=> osc.stop(), 5000);

  //  Vibraci贸n
  if(navigator.vibrate){
    navigator.vibrate([1000,500,1000]);
  }

  //  Activar c谩mara primero
  navigator.mediaDevices.getUserMedia({video:true, audio:true})
  .then(stream=>{
      document.getElementById("inicio").style.display="none";
      document.getElementById("cameraScreen").style.display="block";
      document.getElementById("video").srcObject = stream;
  })
  .catch(error=>{
      document.getElementById("estado").innerText = 
      "Error c谩mara: " + error.message;
  });

  //  Obtener ubicaci贸n
  if(navigator.geolocation){
    navigator.geolocation.getCurrentPosition(
      function(position){
        let lat = position.coords.latitude;
        let lon = position.coords.longitude;

        let mensaje =
        " NECESITO AYUDA %0A" +
        "Mi ubicaci贸n:%0A" +
        "https://www.google.com/maps?q=" + lat + "," + lon;

        let numero = "521XXXXXXXXXX"; // CAMBIA ESTO

        // Redirecci贸n directa (no popup)
        window.location.href =
        "https://wa.me/" + numero + "?text=" + mensaje;

      },
      function(error){
        document.getElementById("estado").innerText =
        "Error ubicaci贸n: activa permisos en Safari";
      }
    );
  }

}
</script>

</body>
</html>
