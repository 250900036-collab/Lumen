<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>LUMEN</title>

<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#6a00ff">

<style>
body{
margin:0;
font-family:Arial, sans-serif;
background:#140028;
color:white;
overflow:hidden;
}

/* PARTICULAS */
canvas{
position:fixed;
top:0;
left:0;
z-index:-1;
}

/* PANTALLAS */
.screen{
position:absolute;
width:100%;
height:100vh;
display:flex;
flex-direction:column;
justify-content:center;
align-items:center;
text-align:center;
opacity:0;
transition:opacity 0.8s ease;
pointer-events:none; /* 游댠 FIX IMPORTANTE */
}

.active{
opacity:1;
pointer-events:auto; /* 游댠 SOLO LA ACTIVA RECIBE CLICS */
}

/* TITULO FLOTANTE */
.title{
font-size:55px;
text-shadow:0 0 15px #fff,0 0 30px #a020f0,0 0 60px #ff00ff;
animation:floatUp 4s ease-in-out infinite alternate;
}

@keyframes floatUp{
0%{transform:translateY(20px);}
100%{transform:translateY(-20px);}
}

/* INPUTS */
input{
padding:12px;
margin:8px;
border-radius:10px;
border:none;
width:230px;
outline:none;
}

/* BOTONES */
button{
padding:12px 25px;
border-radius:10px;
border:none;
margin-top:10px;
font-weight:bold;
cursor:pointer;
background:#a020f0;
color:white;
}

/* BOTON SOS */
#sosBtn{
width:200px;
height:200px;
border-radius:50%;
background:red;
color:white;
font-size:35px;
box-shadow:0 0 40px red;
margin-top:30px;
animation:pulse 1.5s infinite;
}

@keyframes pulse{
0%{transform:scale(1);box-shadow:0 0 30px red;}
50%{transform:scale(1.1);box-shadow:0 0 80px red;}
100%{transform:scale(1);box-shadow:0 0 30px red;}
}
</style>
</head>

<body>

<canvas id="particles"></canvas>

<!-- BIENVENIDA -->
<div id="welcome" class="screen active">
<h1 class="title">LUMEN</h1>
<p>Bienvenido</p>
</div>

<!-- LOGIN -->
<div id="auth" class="screen">
<h1 class="title">LUMEN</h1>
<input type="text" id="user" placeholder="Usuario">
<input type="password" id="pass" placeholder="Contrase침a">
<button onclick="register()">Registrarse</button>
<button onclick="login()">Iniciar Sesi칩n</button>
<p id="msg"></p>
</div>

<!-- APP -->
<div id="app" class="screen">
<h1 class="title">LUMEN</h1>
<button id="sosBtn">SOS</button>
<button onclick="logout()">Cerrar sesi칩n</button>
</div>

<script>

/* ELEMENTOS */
const welcome = document.getElementById("welcome");
const auth = document.getElementById("auth");
const app = document.getElementById("app");
const user = document.getElementById("user");
const pass = document.getElementById("pass");
const msg = document.getElementById("msg");
const sosBtn = document.getElementById("sosBtn");

/* TRANSICION */
function showScreen(screen){
document.querySelectorAll(".screen").forEach(s=>s.classList.remove("active"));
screen.classList.add("active");
}

/* BIENVENIDA 3s */
setTimeout(()=>{
if(localStorage.getItem("lumenLogged")==="true"){
showScreen(app);
}else{
showScreen(auth);
}
},3000);

/* REGISTRO */
function register(){
if(user.value && pass.value){
localStorage.setItem("lumenUser",user.value);
localStorage.setItem("lumenPass",pass.value);
msg.innerText="Usuario creado correctamente";
}
}

/* LOGIN */
function login(){
if(user.value===localStorage.getItem("lumenUser") &&
pass.value===localStorage.getItem("lumenPass")){
localStorage.setItem("lumenLogged","true");
showScreen(app);
}else{
msg.innerText="Datos incorrectos";
}
}

/* LOGOUT */
function logout(){
localStorage.removeItem("lumenLogged");
location.reload();
}

/* ALARMA */
const alarm = new Audio("https://actions.google.com/sounds/v1/alarms/alarm_clock.ogg");
alarm.load();

function playAlarm(){
alarm.currentTime=0;
alarm.play().catch(()=>{});
}

/* PERMISO SENSOR iPhone */
let motionEnabled=false;

function enableMotion(){
if(typeof DeviceMotionEvent!=='undefined' &&
typeof DeviceMotionEvent.requestPermission==='function'){
DeviceMotionEvent.requestPermission().then(response=>{
if(response==='granted'){
window.addEventListener('devicemotion',detectShake);
motionEnabled=true;
}
});
}else{
window.addEventListener('devicemotion',detectShake);
motionEnabled=true;
}
}

document.addEventListener("click", enableMotion, {once:true});

/* SOS */
sosBtn.addEventListener("click",()=>{

playAlarm();

if(navigator.vibrate){
navigator.vibrate([500,200,500]);
}

navigator.geolocation.getCurrentPosition(
pos=>{
const lat=pos.coords.latitude;
const lon=pos.coords.longitude;

const mensaje="游뚿 NECESITO AYUDA 游뚿 https://maps.google.com/?q="+lat+","+lon;
const encoded=encodeURIComponent(mensaje);

/* Intentar abrir app WhatsApp */
window.location.href="whatsapp://send?text="+encoded;

/* Fallback navegador */
setTimeout(()=>{
window.location.href="https://wa.me/?text="+encoded;
},1500);

},
()=>{
alert("Activa permisos de ubicaci칩n.");
}
);

});

/* AGITAR = 911 */
let shakeThreshold=18;
let lastX=null,lastY=null,lastZ=null;
let shakeBlock=false;

function detectShake(event){
if(!motionEnabled) return;

const acc=event.accelerationIncludingGravity;
if(!acc) return;

if(lastX===null){
lastX=acc.x; lastY=acc.y; lastZ=acc.z;
return;
}

let deltaX=Math.abs(lastX-acc.x);
let deltaY=Math.abs(lastY-acc.y);
let deltaZ=Math.abs(lastZ-acc.z);

if(deltaX>shakeThreshold || deltaY>shakeThreshold || deltaZ>shakeThreshold){
if(!shakeBlock){
shakeBlock=true;

if(navigator.vibrate){
navigator.vibrate([300,100,300]);
}

window.location.href="tel:911";

setTimeout(()=>{shakeBlock=false;},5000);
}
}

lastX=acc.x;
lastY=acc.y;
lastZ=acc.z;
}

/* PARTICULAS */
const canvas=document.getElementById("particles");
const ctx=canvas.getContext("2d");
canvas.width=window.innerWidth;
canvas.height=window.innerHeight;

let particles=[];
for(let i=0;i<60;i++){
particles.push({
x:Math.random()*canvas.width,
y:Math.random()*canvas.height,
r:Math.random()*3+1,
d:Math.random()*1
});
}

function draw(){
ctx.clearRect(0,0,canvas.width,canvas.height);
ctx.fillStyle="rgba(160,32,240,0.7)";
particles.forEach(p=>{
ctx.beginPath();
ctx.arc(p.x,p.y,p.r,0,Math.PI*2);
ctx.fill();
p.y-=p.d;
if(p.y<0){p.y=canvas.height;}
});
requestAnimationFrame(draw);
}
draw();

/* SERVICE WORKER */
if('serviceWorker' in navigator){
navigator.serviceWorker.register('sw.js');
}

</script>
</body>
</html>
