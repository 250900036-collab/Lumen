<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>LUMEN</title>

<style>
body{
margin:0;
height:100vh;
display:flex;
flex-direction:column;
justify-content:center;
align-items:center;
background: radial-gradient(circle at center, #6a00ff, #1a001f);
font-family:Arial;
color:white;
overflow:hidden;
}

#sosBtn{
width:220px;
height:220px;
border-radius:50%;
background:red;
color:white;
font-size:40px;
border:none;
box-shadow:0 0 40px red;
}

#text{
margin-top:20px;
font-size:18px;
opacity:0.8;
}

video{
position:fixed;
top:0;
left:0;
width:100%;
height:100%;
object-fit:cover;
display:none;
z-index:-1;
}
</style>
</head>

<body>

<video id="camera" autoplay playsinline></video>

<button id="sosBtn">SOS</button>
<div id="text">Presiona si necesitas ayuda</div>

<script>
const btn = document.getElementById("sosBtn");
const cam = document.getElementById("camera");

btn.addEventListener("click", async () => {

    // Vibraci贸n
    if(navigator.vibrate){
        navigator.vibrate([500,200,500,200,1000]);
    }

    // Sirena fuerte
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    const oscillator = audioCtx.createOscillator();
    const gainNode = audioCtx.createGain();

    oscillator.type = "sawtooth";
    oscillator.frequency.setValueAtTime(800, audioCtx.currentTime);
    oscillator.frequency.linearRampToValueAtTime(1400, audioCtx.currentTime + 1);

    oscillator.connect(gainNode);
    gainNode.connect(audioCtx.destination);
    gainNode.gain.value = 1;

    oscillator.start();

    // Activar c谩mara
    try{
        const stream = await navigator.mediaDevices.getUserMedia({video:true});
        cam.srcObject = stream;
        cam.style.display = "block";
        btn.style.display = "none";
        document.getElementById("text").style.display = "none";
    }catch(e){
        alert("Permite acceso a la c谩mara");
    }

    // Obtener ubicaci贸n
    if(navigator.geolocation){
        navigator.geolocation.getCurrentPosition(function(position){

            const lat = position.coords.latitude;
            const lon = position.coords.longitude;

            const mensaje =
            " NECESITO AYUDA \n\n" +
            "Mi ubicaci贸n:\n" +
            "https://maps.google.com/?q=" + lat + "," + lon;

            const url = "whatsapp://send?text=" + encodeURIComponent(mensaje);

            window.location.href = url;

        }, function(){
            alert("Activa la ubicaci贸n en ajustes");
        });
    }

});
</script>

</body>
</html>
